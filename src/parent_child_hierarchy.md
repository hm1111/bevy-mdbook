# 5.6. 父子层级

在技术上，实体/组件本身并不能形成层次结构（ECS 是一种扁平的数据结构）。然而，逻辑层级是游戏中常见的模式。

Bevy 通过在相应实体上添加 `Parent` 和 `Children` 组件来支持创建这样的逻辑链接，从而形成一个虚拟的“层级”。

当使用 `Commands` 生成实体时，`Commands` 具有将子实体添加到父实体的方法，这会自动添加正确的组件：

请注意，使用`Commnads` 仅设置了`Parent`和`Children`组件，而没有其他内容。特别是，它不会为你添加变换或可见性。如果你需要这些功能，则需要自己添加这些组件，例如使用`SpatialBundle`。

你可以使用`commands`删除整个层次结构。

## 访问父级/子级

要创建一个使用层级结构的系统，通常需要两个查询：

1. 一个查询用于获取子实体所需的组件。

2. 另一个查询用于获取父实体所需的组件。

其中一个查询应该包含适当的组件，以获取另一个查询所需的实体 ID：

1. 如果想要遍历实体并查找其父实体，则在子查询中包含 `Parent` 组件。

2. 如果想要遍历实体并查找其子实体，则在父查询中包含 `Children` 组件。

## 变换和可见性传播

如果你的实体代表“游戏世界中的对象”，那么你可能期望子级受到父级的影响。

变换传播允许子级相对于其父级定位并随其移动。

可见性传播允许如果你手动隐藏其父级，则子级也被隐藏。

Bevy 附带的大多数 Bundle 自动提供这些行为。查看你正在使用的 Bundle 的文档。例如，相机 Bundle 具有变换，但不具有可见性。

另外，你可以使用 `SpatialBundle` 来确保你的实体具有所有必要的组件。

## 已知的陷阱

### 销毁子级实体

当你销毁一个有父级的实体时，Bevy不会自动将其从父级的`Children`中移除。 当你查询父级实体的所有子级时，会得到一个无效的子级，任何对该子级的操作都会引发错误：

`thread 'main' panicked at 'Attempting to create an EntityCommands for entity 7v0, which doesn't exist.'
`

建议使用`remove_children`方法先将其从父级中移除，然后再使用`despawn`方法销毁。