# 3.3. 自定义Bevy(功能，模块)

Bevy是模块化，且可配置的，它是由许多相互独立的crates实现的。更高级的功能都是建立在底层crates之上。更底层的crates也可在其他非Bevy项目被使用。

## Bevy Cargo Features

[参考链接](https://bevy-cheatbook.github.io/setup/bevy-config.html#bevy-cargo-features)

在Bevy项目中，你可以使用`cargo features`来启用/禁用Bevy的一些功能。

很多通用功能默认是开启的，Cargo不允许你只禁用单个默认功能。如果你想禁用其中的一些功能，你首先需要禁用所有的功能，然后再开启你需要的功能。

[这里](https://docs.rs/crate/bevy/0.12.0/features)可以查看Bevy的所有功能。


## 图形/渲染有关的功能

对于图形应用/游戏，你可能需要`bevy_winit`和其他和渲染有关的功能，针对Linux系统，你可能需要`x11`或`wayland`。

若想使用渲染，`bevy_render`和`bevy_core_pipeline`是必须的。

若只需要2D，而不是3D，需要添加`bevy_sprite`。

若只需要3D，而不是2D，需要添加`bevy_pbr`，若需要从GLTF文件中加载3D模型，需要添加`bevy_gltf`。

若需要Bevy UI，需要添加`bevy_text`和`bevy_ui`。`default_font`会插入一个简单的字体文件，所以你不需要在你的项目中添加额外的字体文件。若你想要使用其他字体，你需要禁用`default_font`。

若你想在屏幕上绘制调试线条和形状，需要添加`bevy_gizmos`。

若你不需要任何图形，你可以禁用以上所有功能。

## 文件格式

你可以使用相关的Bevy功能来禁用/启用从各种文件中加载资产的支持。

如果你想要禁用从特定文件格式加载资源，你可以在 Cargo.toml 文件中添加相应的功能标签，并将其设置为 false。同样地，如果你想要启用从特定文件格式加载资源，你可以将相应的功能标签设置为 true。

[查看更多相关信息](https://bevy-cheatbook.github.io/builtins.html#file-formats)

## 输入设备

若你不想要对游戏手柄(控制器/操纵杆)进行支持，你需要禁用`bevy_gilrs`。

## 指定平台

### Linux窗口后端

在Linux中，你可以选择支持x11，或wayland，或者两者都支持。x11是默认支持的，它是一个古老的系统，能兼容几乎所有的发行版本，能让你的应用构建体积更小，编译速度更快。若你想以充分和原生地支持现代Linux环境，你可能需要额外启用Wayland。这将为你的项目增加一些额外的传递依赖。

一些Linux发行版或平台可能在X11上遇到问题，而在Wayland上运行得更好。为了获得最佳的兼容性，你应该同时启用这两个功能。

### WebGPU vs WebGL2

对于Web应用，你可以选择使用WebGPU或WebGL2。

WebGPU是一个更现代化的解决方案，它能提供更好的性能和更多的功能，但是浏览器对其支持有限。（只能运行在最新的Chrome和Firefox浏览器中）

WebGL2能为所有浏览器提供更好的兼容性，但是它的性能更差，功能更少。

若`webgl2`功能被启用，WebGL2将被使用，否则WebGPU将被使用。

### 开发有关的功能

#### 资产热加载和处理

`filesystem_watcher`能支持桌面平台的资产热重载。这意味着当你在项目中修改了某些资源文件（如图像、音频、文本文件等），Bevy 引擎可以自动检测到这些变化，并在运行时重新加载这些资产，而无需重新启动整个应用程序。这对于开发者来说是一个非常有用的功能，因为它可以大大加快开发过程中的迭代速度。

`asset_processor`（资产处理器）特性支持资产处理，允许你在开发过程中自动转换和优化资产。这个特性对于游戏开发者和其他需要处理大量图像、音频和其他类型文件的人来说非常有用。

#### 动态链接

`dynamic_linking`使得 Bevy 被构建并链接为一个共享/动态库。这将使得开发过程中的重新编译速度快得多。

这仅在桌面平台上受支持。已知在 Linux 上运行良好。Windows 和 macOS 也支持，但测试较少，过去曾出现过问题。

除非你有非常充分且特殊的理由，并且知道自己在做什么，否则不建议在打算发布给他人的发行版构建中启用此功能。它引入了不必要的复杂性（你需要捆绑额外的文件），并且可能导致事情无法正常工作。你应该只在开发过程中使用它。

出于这个原因，将功能指定为 cargo 的命令行选项而不是放在 Cargo.toml 中可能会更方便。只需像这样运行项目：

`cargo run --features bevy/dynamic_linking`

#### 跟踪

`trace` 和 `wgpu_trace` 对于分析和诊断性能问题可能很有用。

- `trace`：这个特性允许你记录应用程序的执行轨迹，包括函数调用、事件和其他重要的执行点。通过分析这些轨迹，你可以了解应用程序的性能瓶颈，优化代码，提高运行效率。

- `wgpu_trace`：这个特性专门用于WebGPU的性能分析。WebGPU是一种新的Web图形API，它提供了高性能的图形和计算能力。`wgpu_trace` 可以帮助你跟踪WebGPU的调用，分析渲染性能，找出潜在的问题。

如果你在开发Bevy应用程序时遇到了性能问题，或者想要优化你的应用程序，启用这些特性可能会有所帮助。你可以在Cargo.toml文件中添加相应的特性标签，然后使用 `cargo run` 命令运行你的应用程序，并收集性能数据。

请注意，这些特性可能会影响应用程序的性能，因为它们需要额外的资源来记录和分析数据。因此，在生产环境中，你应该谨慎使用这些特性，并在性能测试完成后禁用它们。

`trace_chrome` 和 `trace_tracy` 是两种用于可视化追踪数据的后端选择。

`trace_chrome` 是针对 Google Chrome 浏览器的追踪可视化工具，而`trace_tracy` 则是 Bevy 引擎自带的一个追踪可视化工具。